# 58同城北京二手房爬虫

这是一个用于爬取58同城北京二手房信息的Python爬虫脚本，支持按区域、商圈、价格、房型等多维度筛选。

## 功能特点

- 支持按**区域**爬取（朝阳、海淀、丰台等17个区）
- 支持按**商圈**爬取（望京、中关村、国贸等100+商圈）
- 支持多条件筛选（价格、房型、面积、朝向、楼层、房龄、装修）
- 支持批量爬取多个区域或商圈
- 支持爬取详情页获取更多信息
- 反爬虫处理（随机User-Agent、请求延迟等）
- 数据保存为CSV和JSON格式
- 交互式命令行界面

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 交互式模式（推荐新手）

```bash
python main.py -i
```

### 2. 命令行模式

```bash
# 列出所有可用选项
python main.py --list

# 列出某区域的所有商圈
python main.py --list-areas 朝阳

# 爬取朝阳区前5页
python main.py -d 朝阳 -p 5

# 爬取朝阳区望京商圈
python main.py -d 朝阳 -a 望京 -p 3

# 批量爬取多个区域
python main.py --districts 朝阳,海淀,丰台 -p 3

# 批量爬取某区域所有商圈
python main.py --all-areas 朝阳 -p 2

# 多条件筛选
python main.py -d 朝阳 --price 300-350万 --room 二室 --size 90-110平方米 -p 5

# 爬取详情页（更多信息但速度慢）
python main.py -d 海淀 -p 2 --detail
```

### 3. 直接运行示例

```bash
python spider_58_enhanced.py
```

## 命令行参数

| 参数 | 说明 | 示例 |
|------|------|------|
| `-i, --interactive` | 交互式模式 | `python main.py -i` |
| `--list` | 列出所有筛选选项 | `python main.py --list` |
| `--list-areas 区域` | 列出区域商圈 | `python main.py --list-areas 朝阳` |
| `-d, --district` | 区域 | `-d 朝阳` |
| `-a, --area` | 商圈 | `-a 望京` |
| `--price` | 价格区间 | `--price 300-350万` |
| `--room` | 房型 | `--room 二室` |
| `--size` | 面积区间 | `--size 90-110平方米` |
| `--orient` | 朝向 | `--orient 南北` |
| `--floor` | 楼层 | `--floor 中层` |
| `--age` | 房龄 | `--age 5-10年` |
| `--decor` | 装修 | `--decor 精装修` |
| `--districts` | 批量爬取区域 | `--districts 朝阳,海淀` |
| `--all-areas` | 爬取区域所有商圈 | `--all-areas 朝阳` |
| `-p, --pages` | 爬取页数 | `-p 5` |
| `--detail` | 爬取详情页 | `--detail` |
| `-o, --output` | 输出目录 | `-o data` |

## 支持的区域

朝阳、海淀、昌平、丰台、大兴、通州、房山、顺义、西城、东城、密云、石景山、怀柔、门头沟、延庆、平谷、北京周边

## 支持的筛选条件

### 价格区间
150万以下、150-250万、250-300万、300-350万、350-400万、400-500万、500-650万、650-1000万、1000万以上

### 房型
一室、二室、三室、四室、五室、五室以上

### 面积
60平方米以下、60-70平方米、70-80平方米、80-90平方米、90-110平方米、110-130平方米、130-160平方米、160-250平方米、250平方米以上

### 朝向
东、南、西、北、南北、东西、东南、西南、东北、西北

### 楼层
底层、低层、中层、高层、顶层

### 房龄
2年内、2-5年、5-10年、10年以上

### 装修
毛坯、简单装修、精装修、豪华装修

## 输出文件

- `data/houses_*.csv` - CSV格式的房源数据
- `data/houses_*.json` - JSON格式的房源数据

## 数据字段

每条房源信息包含以下字段：

| 字段 | 说明 |
|------|------|
| `house_id` | 房源ID |
| `title` | 房源标题 |
| `total_price` | 总价（万元） |
| `price_per_sqm` | 单价（元/平方米） |
| `room_type` | 房型（如：3室2厅1卫） |
| `rooms/halls/bathrooms` | 室/厅/卫数量 |
| `area` | 面积（平方米） |
| `orientation` | 朝向 |
| `floor` | 楼层信息 |
| `build_year` | 建造年份 |
| `community` | 小区名称 |
| `district` | 所属区域 |
| `business_area` | 所属商圈 |
| `address` | 详细地址 |
| `has_elevator` | 是否有电梯 |
| `near_subway` | 是否近地铁 |
| `tax_status` | 满五/满二状态 |
| `tags` | 房源标签 |
| `url` | 房源详情页链接 |
| `crawl_time` | 爬取时间 |

## 注意事项

1. **反爬虫机制**：58同城有反爬虫机制，脚本已添加：
   - 随机User-Agent轮换
   - 请求延迟（1-3秒）
   - 页面间延迟（3-6秒）

2. **验证码**：如果遇到验证码，脚本会等待更长时间后重试。如果频繁遇到验证码，建议：
   - 增加延迟时间
   - 减少爬取页数
   - 使用代理IP

3. **合法使用**：请遵守网站的robots.txt和使用条款，合理控制爬取频率。

## 文件结构

```
renhao_spider/
├── config.py              # 配置文件（区域、商圈、筛选条件）
├── spider_58_enhanced.py  # 增强版爬虫主程序
├── spider_58.py           # 基础版爬虫（保留）
├── main.py                # 命令行工具
├── requirements.txt       # 依赖包
├── README.md              # 说明文档
└── data/                  # 数据输出目录
    ├── houses_*.csv
    └── houses_*.json
```

## 更新日志

### v2.0
- 新增按商圈爬取功能
- 新增多条件筛选（朝向、楼层、房龄、装修）
- 新增批量爬取多个区域/商圈
- 新增交互式命令行界面
- 优化数据提取，获取更多房源信息
- 移除地铁站筛选（根据实际需求）

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数据报告 - 房产数据分析系统</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/report.css">
  <link rel="stylesheet" href="css/modal.css">
</head>
<body>
  <div class="report-page">
    <!-- 顶部导航 -->
    <header class="header">
      <div class="header-content">
        <div class="header-logo">
          <span class="logo-icon">🏠</span>
          <span>房析</span>
        </div>
        
        <nav class="header-nav">
          <a href="index.html" class="header-nav-item">
            <i data-lucide="home"></i>
            <span>首页</span>
          </a>
          <a href="beijing.html" class="header-nav-item">
            <i data-lucide="building"></i>
            <span>北京分析</span>
          </a>
          <a href="advanced.html" class="header-nav-item">
            <i data-lucide="bar-chart-3"></i>
            <span>高级分析</span>
          </a>
          <a href="report.html" class="header-nav-item active">
            <i data-lucide="file-text"></i>
            <span>数据报告</span>
          </a>
          <a href="settings.html" class="header-nav-item">
            <i data-lucide="settings"></i>
            <span>设置</span>
          </a>
        </nav>
        
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="userBtn">
            <i data-lucide="user"></i>
            <span id="userDisplay">用户</span>
          </button>
          <button class="btn btn-outline btn-sm" id="logoutBtn">退出</button>
        </div>
      </div>
    </header>
    
    <!-- 页面横幅 -->
    <section class="page-banner">
      <div class="banner-content">
        <h1 class="page-title">
          <i data-lucide="file-text"></i>
          数据报告中心
        </h1>
        <p class="page-subtitle">专业的房产市场分析报告，助您深度了解市场动态</p>
      </div>
    </section>
    
    <!-- 主内容区 -->
    <main class="report-main">
      <!-- 生成报告按钮 -->
      <div style="text-align: center; margin: 24px 0;">
        <button class="btn btn-primary generate-btn">
          <i data-lucide="file-plus"></i>
          生成自定义报告
        </button>
      </div>
      
      <!-- 最新报告列表 -->
      <div class="report-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="clock"></i>
            最新报告
          </h2>
          <a href="#" class="view-all">查看全部 <i data-lucide="chevron-right"></i></a>
        </div>
        
        <div class="report-list">
          <!-- 动态加载报告列表 -->
        </div>
      </div>
      
      <!-- 我的报告 -->
      <div class="report-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="user"></i>
            我的报告
          </h2>
        </div>
        <div class="my-reports-list">
          <!-- 动态加载我的报告 -->
        </div>
      </div>
      
      <!-- ✅ 添加未登录用户功能提示 -->
      <div class="guest-notice" id="guestNotice" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
          <div style="display: flex; align-items: center; gap: 15px;">
              <i data-lucide="info" style="width: 24px; height: 24px; flex-shrink: 0;"></i>
              <div style="flex: 1;">
                  <h4 style="margin: 0 0 8px 0; font-size: 16px;">您正在以访客身份浏览</h4>
                  <p style="margin: 0; opacity: 0.9; font-size: 14px;">登录后可生成自定义报告并查看历史报告</p>
              </div>
              <a href="login.html" style="background: white; color: #667eea; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 500; white-space: nowrap; transition: transform 0.2s;">
                  立即登录
              </a>
          </div>
      </div>

      <script>
      // ✅ 根据登录状态显示/隐藏访客提示
      document.addEventListener('DOMContentLoaded', function() {
          const isLoggedIn = !!localStorage.getItem('token');
          const guestNotice = document.getElementById('guestNotice');
          
          if (!isLoggedIn && guestNotice) {
              guestNotice.style.display = 'block';
          }
      });
      </script>

      <!-- 生成报告模态框 -->
      <div class="modal" id="generateReportModal">
        <div class="modal-overlay" onclick="closeGenerateModal()"></div>
        <div class="modal-content generate-modal">
          <div class="modal-header">
            <h2><i data-lucide="file-plus"></i> 生成自定义报告</h2>
            <button class="modal-close" onclick="closeGenerateModal()">
              <i data-lucide="x"></i>
            </button>
          </div>
          <div class="modal-body">
            <form id="generateReportForm">
              <div class="form-group">
                <label><i data-lucide="tag"></i> 报告类型</label>
                <div class="report-type-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 8px;">
                  <div class="report-type-option" data-type="市场趋势报告" style="padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                      <i data-lucide="trending-up" style="width: 20px; height: 20px; color: white;"></i>
                    </div>
                    <h4 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0;">市场趋势报告</h4>
                    <p style="font-size: 12px; color: #6b7280; margin: 0;">全国及重点城市房价趋势分析</p>
                  </div>
                  <div class="report-type-option" data-type="城市分析报告" style="padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                      <i data-lucide="map-pin" style="width: 20px; height: 20px; color: white;"></i>
                    </div>
                    <h4 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0;">城市分析报告</h4>
                    <p style="font-size: 12px; color: #6b7280; margin: 0;">单一城市深度市场分析</p>
                  </div>
                  <div class="report-type-option" data-type="城市对比报告" style="padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                      <i data-lucide="git-compare" style="width: 20px; height: 20px; color: white;"></i>
                    </div>
                    <h4 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0;">城市对比报告</h4>
                    <p style="font-size: 12px; color: #6b7280; margin: 0;">多城市横向对比分析</p>
                  </div>
                  <div class="report-type-option" data-type="投资价值报告" style="padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">
                      <i data-lucide="dollar-sign" style="width: 20px; height: 20px; color: white;"></i>
                    </div>
                    <h4 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0;">投资价值报告</h4>
                    <p style="font-size: 12px; color: #6b7280; margin: 0;">房产投资回报率分析</p>
                  </div>
                </div>
                <input type="hidden" name="report_type" required>
              </div>
              <div class="form-group">
                <label><i data-lucide="map-pin"></i> 城市（可选）</label>
                <input type="text" name="city" placeholder="例如：北京">
              </div>
              <div class="form-group">
                <label><i data-lucide="layers"></i> 分析区域（可选）</label>
                <input type="text" name="area" id="areaInput" placeholder="例如：海淀区">
                <small id="areaHint" style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">根据报告类型自动调整</small>
              </div>
              <div class="form-group" style="background: #f0f9ff; padding: 12px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                <p style="margin: 0; font-size: 13px; color: #1e40af;">
                  <i data-lucide="info" style="width: 14px; height: 14px; vertical-align: middle;"></i>
                  报告将基于最新的市场数据生成，预计需要 30-60 秒
                </p>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()">取消</button>
            <button type="submit" form="generateReportForm" class="btn btn-primary">
              <i data-lucide="zap"></i> 生成报告
            </button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-info">
          <span class="footer-logo">🏠 房析</span>
          <span class="footer-copyright">© 2024 房产数据分析系统. All rights reserved.</span>
        </div>
        <div class="footer-links">
          <a href="#">关于我们</a>
          <a href="#">使用条款</a>
          <a href="#">隐私政策</a>
          <a href="#">联系我们</a>
        </div>
      </div>
    </footer>
  </div>
  
  <!-- Scripts -->
  <script src="js/mock-data.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/report.js"></script>
</body>
</html>


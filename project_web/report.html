<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数据报告 - 房产数据分析系统</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/report.css">
  <link rel="stylesheet" href="css/modal.css">
</head>
<body>
  <div class="report-page">
    <!-- 顶部导航 -->
    <header class="header">
      <div class="header-content">
        <div class="header-logo">
          <span class="logo-icon">🏠</span>
          <span>房析</span>
        </div>
        
        <nav class="header-nav">
          <a href="index.html" class="header-nav-item">
            <i data-lucide="home"></i>
            <span>首页</span>
          </a>
          <a href="beijing.html" class="header-nav-item">
            <i data-lucide="building"></i>
            <span>北京分析</span>
          </a>
          <a href="report.html" class="header-nav-item active">
            <i data-lucide="file-text"></i>
            <span>数据报告</span>
          </a>
          <a href="settings.html" class="header-nav-item">
            <i data-lucide="settings"></i>
            <span>设置</span>
          </a>
        </nav>
        
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="userBtn">
            <i data-lucide="user"></i>
            <span id="userDisplay">用户</span>
          </button>
          <button class="btn btn-outline btn-sm" id="logoutBtn">退出</button>
        </div>
      </div>
    </header>
    
    <!-- 页面横幅 -->
    <section class="page-banner">
      <div class="banner-content">
        <h1 class="page-title">
          <i data-lucide="file-text"></i>
          数据报告中心
        </h1>
        <p class="page-subtitle">专业的房产市场分析报告，助您深度了解市场动态</p>
      </div>
    </section>
    
    <!-- 主内容区 -->
    <main class="report-main">
      <!-- 报告类型选择 -->
      <div class="report-types">
        <!-- 动态加载报告类型 -->
      </div>
      
      <!-- 生成报告按钮 -->
      <div style="text-align: center; margin: 24px 0;">
        <button class="btn btn-primary generate-btn">
          <i data-lucide="file-plus"></i>
          生成报告
        </button>
      </div>
      
      <!-- 最新报告列表 -->
      <div class="report-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="clock"></i>
            最新报告
          </h2>
          <a href="#" class="view-all">查看全部 <i data-lucide="chevron-right"></i></a>
        </div>
        
        <div class="report-list">
          <!-- 动态加载报告列表 -->
        </div>
      </div>
      
      <!-- 我的报告 -->
      <div class="report-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="user"></i>
            我的报告
          </h2>
        </div>
        <div class="my-reports-list">
          <!-- 动态加载我的报告 -->
        </div>
      </div>
      
      <!-- 报告详情区域 -->
      <div class="report-detail" id="report-detail" style="display: none;">
        <div class="detail-header">
          <h2 class="detail-title">报告标题</h2>
          <p class="detail-meta">
            <span><i data-lucide="calendar"></i> 2024-12-10</span>
            <span><i data-lucide="eye"></i> 1,234 次查看</span>
          </p>
        </div>
        
        <div class="detail-content">
          <p>报告内容摘要，包含主要发现和数据指标。</p>
          <div class="detail-chart" id="detail-chart" style="height: 400px;"></div>
        </div>
        
        <div class="detail-actions">
          <button class="btn-share">
            <i class="fas fa-share-alt"></i>
            分享
          </button>
        </div>
        
        <div class="detail-footer">
          <button class="btn btn-secondary" id="backBtn">
            <i data-lucide="arrow-left"></i>
            返回报告列表
          </button>
        </div>
      </div>
      
      <!-- 在报告类型选择区域后添加未登录提示 -->
      <div class="report-types">
        <!-- 报告类型卡片由 JS 动态生成 -->
      </div>

      <!-- ✅ 添加未登录用户功能提示 -->
      <div class="guest-notice" id="guestNotice" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
          <div style="display: flex; align-items: center; gap: 15px;">
              <i data-lucide="info" style="width: 24px; height: 24px; flex-shrink: 0;"></i>
              <div style="flex: 1;">
                  <h4 style="margin: 0 0 8px 0; font-size: 16px;">您正在以访客身份浏览</h4>
                  <p style="margin: 0; opacity: 0.9; font-size: 14px;">登录后可生成自定义报告并查看历史报告</p>
              </div>
              <a href="login.html" style="background: white; color: #667eea; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 500; white-space: nowrap; transition: transform 0.2s;">
                  立即登录
              </a>
          </div>
      </div>

      <script>
      // ✅ 根据登录状态显示/隐藏访客提示
      document.addEventListener('DOMContentLoaded', function() {
          const isLoggedIn = !!localStorage.getItem('token');
          const guestNotice = document.getElementById('guestNotice');
          
          if (!isLoggedIn && guestNotice) {
              guestNotice.style.display = 'block';
          }
      });
      </script>

      <!-- 生成报告模态框 -->
      <div class="modal" id="generateReportModal">
        <div class="modal-overlay" onclick="closeGenerateModal()"></div>
        <div class="modal-content generate-modal">
          <div class="modal-header">
            <h2><i data-lucide="file-plus"></i> 生成自定义报告</h2>
            <button class="modal-close" onclick="closeGenerateModal()">
              <i data-lucide="x"></i>
            </button>
          </div>
          <div class="modal-body">
            <form id="generateReportForm">
              <div class="form-group">
                <label><i data-lucide="tag"></i> 报告类型</label>
                <select name="type" required>
                  <option value="">请选择报告类型</option>
                  <option value="market_analysis">市场趋势报告</option>
                  <option value="district_analysis">城市分析报告</option>
                  <option value="comparison">城市对比报告</option>
                  <option value="investment">投资价值报告</option>
                </select>
              </div>
              <div class="form-group">
                <label><i data-lucide="map-pin"></i> 目标城市</label>
                <input type="text" name="city" placeholder="例如：北京" required>
              </div>
              <div class="form-group">
                <label><i data-lucide="layers"></i> 分析区域（可选）</label>
                <input type="text" name="districts" placeholder="多个区域用逗号分隔，例如：朝阳区,海淀区">
                <small>留空则分析整个城市</small>
              </div>
              <div class="form-group">
                <label><i data-lucide="calendar"></i> 数据时间范围（可选）</label>
                <div class="date-range">
                  <input type="date" name="start_date">
                  <span>至</span>
                  <input type="date" name="end_date">
                </div>
              </div>
              <div class="form-group">
                <label><i data-lucide="check-square"></i> 分析指标</label>
                <div class="checkbox-group">
                  <label><input type="checkbox" name="metrics" value="price_trend" checked> 价格趋势</label>
                  <label><input type="checkbox" name="metrics" value="supply_demand"> 供需关系</label>
                  <label><input type="checkbox" name="metrics" value="investment_return"> 投资回报</label>
                  <label><input type="checkbox" name="metrics" value="market_activity"> 市场活跃度</label>
                </div>
              </div>
              <div class="form-group">
                <label><i data-lucide="file-text"></i> 输出格式</label>
                <div class="radio-group">
                  <label><input type="radio" name="format" value="pdf" checked> PDF</label>
                  <label><input type="radio" name="format" value="html"> HTML</label>
                  <label><input type="radio" name="format" value="markdown"> Markdown</label>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()">取消</button>
            <button type="submit" form="generateReportForm" class="btn btn-primary">
              <i data-lucide="zap"></i> 生成报告
            </button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-info">
          <span class="footer-logo">🏠 房析</span>
          <span class="footer-copyright">© 2024 房产数据分析系统. All rights reserved.</span>
        </div>
        <div class="footer-links">
          <a href="#">关于我们</a>
          <a href="#">使用条款</a>
          <a href="#">隐私政策</a>
          <a href="#">联系我们</a>
        </div>
      </div>
    </footer>
  </div>
  
  <!-- Scripts -->
  <script src="js/mock-data.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/report.js"></script>
</body>
</html>

